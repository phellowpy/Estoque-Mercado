<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Estoque</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/login.css"> 
</head>
<body class="d-flex align-items-center justify-content-center vh-100 flex-column"> 
    
    <nav class="navbar navbar-expand-lg w-100 position-absolute top-0">
        <div class="container-fluid">
        <a class="navbar-brand">
            <img src="../arquivos/img/logo_keepinventory.png" alt="Logo KeepInventory" height="60" class="me-2"> 
            KeepInventory
        </a>
            <div class="d-flex ms-auto">
                <ul class="navbar-nav me-3">

                </ul>
                <button class="btn nav-link" id="btn-toggle-darkmode" onclick="toggleDarkMode()">
                    <i class="bi bi-circle-half"></i> Tema
                </button>
            </div>
        </div>
    </nav>

<div class="card card-login p-4 shadow-lg">
    <h3 class="card-header text-center">Acesso Interno</h3>
    <div class="card-body">
        <form id="login-form">
            <div class="mb-3">
                <label for="email" class="form-label">Email da Conta</label>
                <input type="email" class="form-control" id="email" placeholder="seu.email@empresa.com" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Senha</label>
                <input type="password" class="form-control" id="password" placeholder="Sua Senha" required>
            </div>
            <button type="submit" class="btn btn-militar w-100">Entrar</button>
            <div id="login-error" class="alert alert-danger mt-3 d-none">Email ou senha inválidos.</div>
        </form>
    </div>
</div>

<div class="modal fade" id="customAlertModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="customAlertModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="customAlertMessage" role="alert"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-militar" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../js/app.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Verifica se já está logado
        if (typeof getUsuarioLogado !== 'undefined' && getUsuarioLogado()) { 
             window.location.href = 'estoque-produtos.html';
        }

        // Chama a função de atualização de ícone do tema (do app.js)
        const isDarkModeEnabled = localStorage.getItem('darkMode') === 'enabled';
        if (isDarkModeEnabled && !document.body.classList.contains('dark-mode')) {
             document.body.classList.add('dark-mode');
        }
        // Garante que o ícone inicial do tema (na navbar) esteja correto
        if (typeof atualizarIconeTema !== 'undefined') {
            atualizarIconeTema(isDarkModeEnabled); 
        }
    });

    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // IDs corrigidos para usar os IDs originais do seu HTML: 'email' e 'password'
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        
        const errorDiv = document.getElementById('login-error');

        // Chama a função CORRETA do app.js: fazerLogin()
        const usuario = fazerLogin(email, password);

        if (usuario) {
            // Login bem-sucedido: Esconde o erro e mostra o modal de sucesso
            errorDiv.classList.add('d-none');
            exibirMensagemModal("Sucesso!", `Bem-vindo(a), ${usuario.nome}.`, 'alert-success');
            
            setTimeout(() => {
                window.location.href = 'estoque-produtos.html'; 
            }, 1500);
        } else {
            // Login falhou: Mostra o modal de erro (e a div de erro, por garantia)
            errorDiv.classList.remove('d-none');
            exibirMensagemModal("Erro de Login", "Credenciais inválidas. Verifique seu email e senha.", 'alert-danger');
        }
    });
</script>
</body>
</html>